<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="semafloor-room-page-theme.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-item/paper-icon-item.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../app-layout/app-header/app-header.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">

<script src="../lodash/lodash.min.js" charset="utf-8"></script>

<!--
An element providing a solution to no problem in particular.

Example:

    <semafloor-room-page></semafloor-room-page>

@group Seed Elements
@element semafloor-room-page
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="semafloor-room-page">

  <template strip-whitespace>
    <style include="semafloor-room-page-theme"></style>

    <iron-ajax id="roomAjax"
      auto
      url="[[_roomInfoURL]]"
      handle-as="json"
      on-response="_onResponse"
      last-response="{{_roomInfo}}"></iron-ajax>

    <div class="vertical-section">
      <paper-icon-item name="alpha" on-tap="_toggleVerticallapsible">
        <iron-icon icon="icons:star-border"></iron-icon>
        <span>KLB - Tower 5</span>
      </paper-icon-item>
      <iron-collapse id="alpha" horizontal class="alpha-collapsible">
        <div class="alpha-collapsible-container">
          <template is="dom-repeat" items="[[_alphaFloors]]" index-as="index">
            <paper-button name="alpha" raised on-tap="_showFloorDialog">[[item]]</paper-button>
          </template>
        </div>
      </iron-collapse>
      <paper-icon-item name="beta" on-tap="_toggleVerticallapsible">
        <iron-icon icon="icons:star-half"></iron-icon>
        <span>KLB - Tower 2A</span>
      </paper-icon-item>
      <iron-collapse id="beta" horizontal class="beta-collapsible">
        <div class="beta-collapsible-container">
          <paper-button name="beta" raised on-tap="_showFloorDialog">Level 3</paper-button>
        </div>
      </iron-collapse>
      <paper-icon-item name="gamma" on-tap="_toggleVerticallapsible">
        <iron-icon icon="icons:star"></iron-icon>
        <span>SUITE</span>
      </paper-icon-item>
      <iron-collapse id="gamma" horizontal class="gamma-collapsible">
        <div class="gamma-collapsible-container">
          <paper-button name="gamma" raised on-tap="_showFloorDialog">Level 1</paper-button>
        </div>
      </iron-collapse>
    </div>

    <paper-dialog id="floorDialog">
      <app-header-layout>
        <app-header>
          <app-toolbar>
            <paper-icon-button icon="icons:close" dialog-dismiss></paper-icon-button>
          </app-toolbar>
          <app-toolbar>[[_site]] [[_floor]]</app-toolbar>
        </app-header>

        <div class="">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam eaque esse voluptatem quisquam nulla optio! Architecto ullam esse, id, fugit omnis minus tenetur! Vitae debitis eveniet suscipit, iure earum minima iusto ratione. Officia temporibus aspernatur ullam libero minus excepturi, adipisci deleniti ratione inventore, accusantium saepe illum sunt maxime! Maxime, provident!
        </div>
      </app-header-layout>
    </paper-dialog>
  </template>

</dom-module>

<script>
  var _alphaFloors = ['level 1','level 2','level 3','level 3a','level 5','level 6','level 7','level 8','level 9','level 10','level 11','level 12'];
  var _alphaFloorsCode = ['01level','02level','03level','04level','05level','06level','07level','08level','09level','10level','11level','12level'];
  var _sites = ['KLB - Tower 5', 'KLB - Tower 2A', 'SUITE'];

  Polymer({

    is: 'semafloor-room-page',

    properties: {
      _alphaFloors: {
        type: Array,
        value: function () {
          return _alphaFloors
        }
      },
      _openedVerticallapsible: String,
      _roomInfo: Object,
      _roomInfoURL: String,
      _site: String,
      _floor: String,
      _floorIdx: String,

    },

    // Element Lifecycle

    ready: function() {
      // `ready` is called after all elements have been configured, but
      // propagates bottom-up. This element's children are ready, but parents
      // are not.
      //
      // This is the point where you should make modifications to the DOM (when
      // necessary), or kick off any processes the element wants to perform.
    },

    attached: function() {
      // `attached` fires once the element and its parents have been inserted
      // into a document.
      //
      // This is a good place to perform any work related to your element's
      // visual state or active behavior (measuring sizes, beginning animations,
      // loading resources, etc).
    },

    detached: function() {
      // The analog to `attached`, `detached` fires when the element has been
      // removed from a document.
      //
      // Use this to clean up anything you did in `attached`.
    },

    _toggleVerticallapsible: function (ev) {
      var _target = ev.target;

      while (_target && _target.tagName !== 'PAPER-ICON-ITEM') {
        _target = _target.parentElement;
      }

      if (_target && _target.hasAttribute('name')) {
        var _name = _target.getAttribute('name');
        var _opened = this._openedVerticallapsible;
        // _opened && _opened === _name -> set _opened null, toggle(_name)
        // _opened && _opened !== _name -> set _opened, hide(_opened), toggle(_name)
        // _opened is undefined -> set _opened, toggle(_name)
        if (_opened && _opened === _name) {
          this.set('_openedVerticallapsible', '');
        }else {
          if (_opened) {
            this.$[_opened].hide();
          }
          this.set('_openedVerticallapsible', _name);
        }
        this.$[_name].toggle();
      }
    },

    _showFloorDialog: function (ev) {
      var _target = ev.target;

      if (_target && _target.tagName === 'PAPER-BUTTON') {
        if (_target.hasAttribute('name')) {
          var _site = _target.getAttribute('name');
          var _siteIdx = Array.prototype.indexOf.call(['alpha', 'beta', 'gamma'], _site);
          var _floor = String.prototype.toLowerCase.call(_.trim(_target.innerText));
          var _floorIdx = Array.prototype.indexOf.call(_alphaFloors, _floor);
          // reset ajax url.
          this.set('_roomInfoURL', '');
          // empty data object where json data stored at.
          this.set('_roomInfo', null);
          // site name and floor name for dialog's title.
          this.set('_site', _sites[_siteIdx]);
          this.set('_floor', _floor);
          // set floor index to read floor's data.
          this.set('_floorIdx', _alphaFloorsCode[_floorIdx]);
          // set ajax url to read latest data.
          this.set('_roomInfoURL', '../room-info.json');
          console.log('url-set');
          // open dialog...
          this.$.floorDialog.open();
          console.log('dialog-open');
        }
      }
    },

    _onResponse: function (ev) {
      // when ajax receives latesta data...
      console.log('get-json');
      console.log(this._roomInfo);
    },

  });

</script>
